import{a as q}from"./chunk-XDWJ5BTG.js";import{a as A}from"./chunk-OABUGHAJ.js";import{d as I}from"./chunk-TFTKUNPW.js";import{a as C,b as g,c as L,d as U,g as P,i as T,j,k as N,l as G,m as F,r as D,t as V}from"./chunk-KE2X6HN6.js";import"./chunk-I36WQ6MU.js";import"./chunk-PIYG2HY2.js";import{e as _,h as S,i as M,n as k}from"./chunk-6Y6W3DZI.js";import{Fa as R,Ka as c,R as x,Ta as l,Ua as e,Va as r,Wa as m,Y as u,Z as p,db as v,fb as f,hb as h,jb as n,kb as y,l as w,lb as b,ra as a,x as E}from"./chunk-NRNLENJO.js";function B(i,o){if(i&1&&(e(0,"div",50)(1,"div",51),u(),e(2,"svg",52),m(3,"path",53),r(),p(),e(4,"p",54),n(5),r()()()),i&2){let t=f();a(5),y(t.errorMessage)}}function H(i,o){if(i&1&&(e(0,"div",55)(1,"div",51),u(),e(2,"svg",56),m(3,"path",57),r(),p(),e(4,"p",58),n(5),r()()()),i&2){let t=f();a(5),y(t.successMessage)}}function $(i,o){if(i&1&&(e(0,"div",59),n(1),r()),i&2){let t=f();a(),b(" ",t.getErrorMessage("nombre")," ")}}function z(i,o){if(i&1&&(e(0,"div",59),n(1),r()),i&2){let t=f();a(),b(" ",t.getErrorMessage("email")," ")}}function Y(i,o){i&1&&(e(0,"div",60),u(),e(1,"svg",61),m(2,"circle",62)(3,"path",63),r(),p(),e(4,"span",64),n(5,"Cargando roles..."),r()())}function J(i,o){if(i&1&&(e(0,"option",67),n(1),r()),i&2){let t=o.$implicit;l("value",t.id),a(),y(t.nombre)}}function K(i,o){if(i&1&&(e(0,"select",65)(1,"option",42),n(2,"Seleccione un rol"),r(),c(3,J,2,2,"option",66),r()),i&2){let t=f();h("border-red-500",t.hasError("rolId"))("bg-red-50",t.hasError("rolId")),a(3),l("ngForOf",t.rolesDisponibles)}}function Q(i,o){if(i&1&&(e(0,"div",59),n(1),r()),i&2){let t=f();a(),b(" ",t.getErrorMessage("rolId")," ")}}function W(i,o){if(i&1&&(e(0,"div",59),n(1),r()),i&2){let t=f();a(),b(" ",t.getErrorMessage("estado")," ")}}function X(i,o){i&1&&m(0,"div",68)}function Z(i,o){i&1&&(u(),e(0,"svg",45),m(1,"path",69),r())}var O=class i{fb;location;router;api;rolesApi;formRegistro;isLoading=!1;errorMessage=null;successMessage=null;rolesDisponibles=[];loadingRoles=!1;constructor(){this.fb=x(D),this.location=x(_),this.router=x(I),this.api=x(A),this.rolesApi=x(q),this.formRegistro=this.fb.group({nombre:["",[g.required,g.minLength(2),g.maxLength(100)]],email:["",[g.required,g.email,g.maxLength(150)]],rolId:[0,[g.required,g.min(1)]],estado:[1,[g.required]]})}ngOnInit(){this.cargarRoles()}cargarRoles(){this.loadingRoles=!0;let o={estado:1};this.rolesApi.listaRoles(o).pipe(E(d=>w({exito:!1,mensaje:"Error al cargar roles",roles:[]}))).subscribe({next:d=>{d.exito&&Array.isArray(d.roles)?this.rolesDisponibles=d.roles:this.rolesDisponibles=[]},error:d=>{this.rolesDisponibles=[]}}).add(()=>{this.loadingRoles=!1})}registrarUsuario(){if(this.formRegistro.valid){this.errorMessage=null,this.successMessage=null,this.isLoading=!0;let o={nombre:this.formRegistro.value.nombre.trim(),email:this.formRegistro.value.email.trim(),rolId:parseInt(this.formRegistro.value.rolId),estado:this.formRegistro.value.estado};this.api.registroUsuario(o).pipe(E(d=>(this.errorMessage="No se pudo conectar al servidor. Revisa tu red o int\xE9ntalo m\xE1s tarde.",w({exito:!1,mensaje:"Error de conexi\xF3n"})))).subscribe({next:d=>{d.exito?(this.successMessage="Usuario registrado exitosamente",this.formRegistro.reset(),this.formRegistro.patchValue({estado:1,rolId:0}),setTimeout(()=>{this.volverLista()},2e3)):this.errorMessage=d.mensaje||"No se pudo registrar el usuario"},error:d=>{this.errorMessage=this.errorMessage??"No se pudo registrar el usuario."}}).add(()=>{this.isLoading=!1})}else this.markFormGroupTouched()}markFormGroupTouched(){Object.keys(this.formRegistro.controls).forEach(o=>{this.formRegistro.get(o)?.markAsTouched()})}hasError(o){let t=this.formRegistro.get(o);return!!(t&&t.invalid&&t.touched)}getErrorMessage(o){let t=this.formRegistro.get(o);if(t?.errors){if(t.errors.required)return`${this.getFieldDisplayName(o)} es requerido`;if(t.errors.minlength)return`${this.getFieldDisplayName(o)} debe tener al menos ${t.errors.minlength.requiredLength} caracteres`;if(t.errors.maxlength)return`${this.getFieldDisplayName(o)} no puede exceder ${t.errors.maxlength.requiredLength} caracteres`;if(t.errors.email)return"Ingresa un email v\xE1lido";if(t.errors.min)return"Selecciona un rol v\xE1lido"}return""}getFieldDisplayName(o){return{nombre:"El nombre",email:"El email",rolId:"El rol",estado:"El estado"}[o]||o}volverLista(){this.router.navigate(["/usuarios/lista"])}volverAtras(){this.location.back()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=R({type:i,selectors:[["app-registro-usuarios-page"]],decls:78,vars:26,consts:[[1,"flex","flex-col","min-h-screen","bg-white","p-2","sm:p-4","md:p-8"],[1,"flex","items-center","justify-between","pb-4","md:pb-6","border-b","border-gray-300","flex-none"],[1,"flex","items-center","gap-2","md:gap-4"],[1,"bg-orange-600","text-white","rounded-full","p-2","h-8","w-8","md:h-10","md:w-10","flex","items-center","justify-center","hover:bg-orange-700","transition","shadow-lg",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round",1,"w-4","h-4","md:w-5","md:h-5"],["stroke","none","d","M0 0h24v24H0z","fill","none"],["d","M5 12l14 0"],["d","M5 12l4 4"],["d","M5 12l4 -4"],[1,"text-lg","sm:text-xl","md:text-2xl","lg:text-3xl","font-extrabold","text-gray-900"],[1,"hidden","sm:inline"],[1,"sm:hidden"],["class","mt-4 md:mt-6 p-4 bg-red-100 border border-red-300 rounded-lg shadow-sm",4,"ngIf"],["class","mt-4 md:mt-6 p-4 bg-green-100 border border-green-300 rounded-lg shadow-sm",4,"ngIf"],[1,"mt-4","md:mt-8","space-y-4","md:space-y-8","bg-gray-50","p-3","md:p-8","rounded-xl","shadow-2xl",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","lg:grid-cols-12","gap-4","md:gap-8"],[1,"lg:col-span-4","flex","flex-col","space-y-4","md:space-y-6","p-3","md:p-6","bg-gradient-to-br","from-orange-50","to-orange-100","rounded-xl","shadow-lg","border-l-4","border-orange-600"],[1,"text-lg","md:text-xl","font-extrabold","text-orange-600","border-b-2","border-orange-300","pb-2","w-full","text-center","lg:text-left"],[1,"flex","justify-center","lg:justify-start"],[1,"relative","h-20","w-20","md:h-32","md:w-32","rounded-full","bg-gradient-to-br","from-orange-400","to-orange-600","flex","items-center","justify-center","shadow-lg","family-icon"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-10","h-10","md:w-16","md:h-16","text-white"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"],[1,"bg-blue-50","border","border-blue-200","rounded-lg","p-3"],[1,"flex","items-start"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","md:w-5","md:h-5","text-blue-600","mr-2","mt-0.5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-blue-800","text-xs","md:text-sm","font-medium"],[1,"text-blue-700","text-xs","md:text-sm","mt-1"],[1,"lg:col-span-8","space-y-4","md:space-y-6"],[1,"bg-white","p-3","md:p-6","rounded-lg","shadow-md","border-l-4","border-orange-600"],["for","nombre",1,"block","text-sm","md:text-base","font-semibold","text-gray-700","mb-2"],[1,"text-red-500"],["type","text","id","nombre","formControlName","nombre","placeholder","Ej: Juan P\xE9rez, Mar\xEDa Garc\xEDa",1,"w-full","px-4","py-3","border-2","border-gray-200","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500","transition-all","duration-200","text-sm","md:text-base"],["class","mt-2 text-sm text-red-600 font-medium",4,"ngIf"],["for","email",1,"block","text-sm","md:text-base","font-semibold","text-gray-700","mb-2"],["type","email","id","email","formControlName","email","placeholder","usuario@ejemplo.com",1,"w-full","px-4","py-3","border-2","border-gray-200","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500","transition-all","duration-200","text-sm","md:text-base"],["for","rolId",1,"block","text-sm","md:text-base","font-semibold","text-gray-700","mb-2"],["class","flex items-center justify-center py-3",4,"ngIf"],["id","rolId","formControlName","rolId","class","w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all duration-200 text-sm md:text-base",3,"border-red-500","bg-red-50",4,"ngIf"],["for","estado",1,"block","text-sm","md:text-base","font-semibold","text-gray-700","mb-2"],["id","estado","formControlName","estado",1,"w-full","px-4","py-3","border-2","border-gray-200","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500","transition-all","duration-200","text-sm","md:text-base"],["value","1"],["value","0"],[1,"mt-6","md:mt-8","flex","flex-col","sm:flex-row","gap-3","sm:gap-4","justify-center","sm:justify-end","bg-white","p-4","md:p-6","rounded-xl","shadow-lg"],["type","button",1,"w-full","sm:w-auto","px-6","py-3","bg-gray-400","text-white","font-bold","rounded-lg","hover:bg-gray-500","transition","duration-200","shadow-md","disabled:opacity-50","flex","items-center","justify-center",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 19l-7-7m0 0l7-7m-7 7h18"],["type","submit",1,"w-full","sm:w-auto","px-6","py-3","bg-orange-600","text-white","font-bold","rounded-lg","hover:bg-orange-700","transition","duration-200","shadow-md","disabled:opacity-50","flex","items-center","justify-center",3,"disabled"],["class","animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2",4,"ngIf"],["class","w-5 h-5 mr-2","fill","none","stroke","currentColor","viewBox","0 0 24 24",4,"ngIf"],[1,"mt-4","md:mt-6","p-4","bg-red-100","border","border-red-300","rounded-lg","shadow-sm"],[1,"flex","items-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-red-600","mr-2","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-red-800","font-medium","text-sm","md:text-base"],[1,"mt-4","md:mt-6","p-4","bg-green-100","border","border-green-300","rounded-lg","shadow-sm"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-green-600","mr-2","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-green-800","font-medium","text-sm","md:text-base"],[1,"mt-2","text-sm","text-red-600","font-medium"],[1,"flex","items-center","justify-center","py-3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","-ml-1","mr-3","h-5","w-5","text-orange-500"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],[1,"text-gray-600"],["id","rolId","formControlName","rolId",1,"w-full","px-4","py-3","border-2","border-gray-200","rounded-lg","focus:ring-2","focus:ring-orange-500","focus:border-orange-500","transition-all","duration-200","text-sm","md:text-base"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"animate-spin","rounded-full","h-5","w-5","border-b-2","border-white","mr-2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5 13l4 4L19 7"]],template:function(t,s){t&1&&(e(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),v("click",function(){return s.volverAtras()}),u(),e(4,"svg",4),m(5,"path",5)(6,"path",6)(7,"path",7)(8,"path",8),r()(),p(),e(9,"h1",9)(10,"span",10),n(11,"Registrar Nuevo Usuario"),r(),e(12,"span",11),n(13,"Nuevo Usuario"),r()()()(),c(14,B,6,1,"div",12)(15,H,6,1,"div",13),e(16,"form",14),v("ngSubmit",function(){return s.registrarUsuario()}),e(17,"div",15)(18,"div",16)(19,"h2",17),n(20," Informaci\xF3n del Usuario "),r(),e(21,"div",18)(22,"div",19),u(),e(23,"svg",20),m(24,"path",21),r()()(),p(),e(25,"div",22)(26,"div",23),u(),e(27,"svg",24),m(28,"path",25),r(),p(),e(29,"div")(30,"p",26)(31,"strong"),n(32,"Datos importantes"),r()(),e(33,"p",27),n(34," Registra usuarios del sistema con email v\xE1lido y asigna un rol para definir sus permisos de acceso. "),r()()()()(),e(35,"div",28)(36,"div",29)(37,"label",30),n(38," Nombre del Usuario "),e(39,"span",31),n(40,"*"),r()(),m(41,"input",32),c(42,$,2,1,"div",33),r(),e(43,"div",29)(44,"label",34),n(45," Correo Electr\xF3nico "),e(46,"span",31),n(47,"*"),r()(),m(48,"input",35),c(49,z,2,1,"div",33),r(),e(50,"div",29)(51,"label",36),n(52," Rol "),e(53,"span",31),n(54,"*"),r()(),c(55,Y,6,0,"div",37)(56,K,4,5,"select",38)(57,Q,2,1,"div",33),r(),e(58,"div",29)(59,"label",39),n(60," Estado "),e(61,"span",31),n(62,"*"),r()(),e(63,"select",40)(64,"option",41),n(65,"Activo"),r(),e(66,"option",42),n(67,"Inactivo"),r()(),c(68,W,2,1,"div",33),r()()(),e(69,"div",43)(70,"button",44),v("click",function(){return s.volverAtras()}),u(),e(71,"svg",45),m(72,"path",46),r(),n(73," Volver "),r(),p(),e(74,"button",47),c(75,X,1,0,"div",48)(76,Z,2,0,"svg",49),n(77),r()()()()),t&2&&(a(14),l("ngIf",s.errorMessage),a(),l("ngIf",s.successMessage),a(),l("formGroup",s.formRegistro),a(25),h("border-red-500",s.hasError("nombre"))("bg-red-50",s.hasError("nombre")),a(),l("ngIf",s.hasError("nombre")),a(6),h("border-red-500",s.hasError("email"))("bg-red-50",s.hasError("email")),a(),l("ngIf",s.hasError("email")),a(6),l("ngIf",s.loadingRoles),a(),l("ngIf",!s.loadingRoles),a(),l("ngIf",s.hasError("rolId")),a(6),h("border-red-500",s.hasError("estado"))("bg-red-50",s.hasError("estado")),a(5),l("ngIf",s.hasError("estado")),a(2),l("disabled",s.isLoading),a(4),l("disabled",s.isLoading||s.formRegistro.invalid),a(),l("ngIf",s.isLoading),a(),l("ngIf",!s.isLoading),a(),b(" ",s.isLoading?"Guardando...":"Guardar Usuario"," "))},dependencies:[k,S,M,V,P,G,F,C,N,L,U,T,j],styles:[".family-icon[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_float 3s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0)}50%{transform:translateY(-10px)}}"]})};export{O as RegistroUsuariosPage};
